<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Registro Esercizi</title>
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .exercise {
            margin-bottom: 15px;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 5px;
            background-color: #f8f9fa;
            position: relative;
        }
        .remove-exercise {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 3px;
            padding: 5px 10px;
            cursor: pointer;
        }
        .remove-exercise:hover {
            background-color: #c82333;
        }
    </style>
</head>
<body>

<div class="container">
    <h1 class="mb-4">Inserisci i tuoi esercizi</h1>

    <form id="exercise-form" method="POST" action="/submit">
        <!-- Campi del form per Nome e Cognome -->
        <div class="form-group">
            <label for="name">Nome:</label>
            <input type="text" class="form-control" id="name" name="name" required>
        </div>

        <div class="form-group">
            <label for="surname">Cognome:</label>
            <input type="text" class="form-control" id="surname" name="surname" required>
        </div>

        <div id="exercise-container">
            <!-- Gli esercizi saranno aggiunti qui -->
        </div>

        <button type="button" class="btn btn-primary" onclick="addExercise()">Aggiungi Esercizio</button><br><br>

        <input type="submit" class="btn btn-success" value="Invia">
    </form>
</div>

<!-- Bootstrap JS e dipendenze -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
    let exerciseCounter = 1;

    // Dati dal backend
    const districtToExercises = {{ district_to_exercises | tojson | safe }};
    const exerciseToDistrict = {{ exercises_to_district | tojson | safe }};
    const districts = {{ districts | tojson | safe }};
    const exercises = {{ exercises | tojson | safe }};

    function addExercise() {
        const container = document.getElementById('exercise-container');

        const div = document.createElement('div');
        div.className = 'exercise';
        div.id = `exercise-${exerciseCounter}`;

        div.innerHTML = `
            <button type="button" class="remove-exercise" onclick="removeExercise(${exerciseCounter})">Rimuovi</button>

            <h5>Esercizio ${exerciseCounter}</h5>

            <div class="form-group">
                <label for="district${exerciseCounter}">Distretto Muscolare:</label>
                <select class="form-control" id="district${exerciseCounter}" name="exercises[${exerciseCounter}][district]" onchange="updateExercises(${exerciseCounter})" required>
                    <option value="">Seleziona Distretto Muscolare</option>
                    ${districts.map(district => `<option value="${district}">${district}</option>`).join('')}
                </select>
            </div>

            <div class="form-group">
                <label for="exerciseName${exerciseCounter}">Nome Esercizio:</label>
                <select class="form-control" id="exerciseName${exerciseCounter}" name="exercises[${exerciseCounter}][name]" required>
                    <option value="">Seleziona Esercizio</option>
                    ${exercises.map(exercise => `<option value="${exercise}">${exercise}</option>`).join('')}
                </select>
            </div>

            <div class="form-group">
                <label for="reps${exerciseCounter}">Numero Ripetizioni:</label>
                <input type="number" class="form-control" id="reps${exerciseCounter}" name="exercises[${exerciseCounter}][reps]" required>
            </div>

            <div class="form-group">
                <label for="weight${exerciseCounter}">Kilogrammi:</label>
                <input type="number" class="form-control" id="weight${exerciseCounter}" name="exercises[${exerciseCounter}][weight]" required>
            </div>
        `;

        container.appendChild(div);

        exerciseCounter++;
    }

    function removeExercise(index) {
        const exerciseDiv = document.getElementById(`exercise-${index}`);
        if (exerciseDiv) {
            exerciseDiv.remove();
        }
    }

    function updateExercises(index) {
        const districtSelect = document.getElementById(`district${index}`);
        const exerciseSelect = document.getElementById(`exerciseName${index}`);
        const selectedDistrict = districtSelect.value;

        // Reset esercizi
        exerciseSelect.innerHTML = '<option value="">Seleziona Esercizio</option>';

        if (selectedDistrict) {
            const availableExercises = districtToExercises[selectedDistrict];

            availableExercises.forEach(exercise => {
                const option = document.createElement('option');
                option.value = exercise;
                option.textContent = exercise;
                exerciseSelect.appendChild(option);
            });
        }
    }

    // Opzionale: Aggiungi un esercizio di default all'apertura della pagina
    // addExercise();
</script>

</body>
</html>
